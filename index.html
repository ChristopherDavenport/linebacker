<html><head><title>linebacker</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Christopher Davenport" /><meta name="description" content="Thread Pool Management for Scala" /><meta name="og:image" content="/linebacker/img/poster.png" /><meta name="og:title" content="linebacker" /><meta name="og:site_name" content="linebacker" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Thread Pool Management for Scala" /><link rel="icon" type="image/png" href="/linebacker/img/favicon.png" /><meta name="twitter:title" content="linebacker" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Thread Pool Management for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/linebacker/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/linebacker/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/linebacker/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/linebacker/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/linebacker/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/linebacker/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/linebacker/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/linebacker/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/linebacker/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/linebacker/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/linebacker/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/linebacker/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/linebacker/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/linebacker/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/linebacker/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/linebacker/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/linebacker/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/linebacker/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/linebacker/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/linebacker/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/linebacker/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/linebacker/css/style.css" /><link rel="stylesheet" href="/linebacker/css/palette.css" /><link rel="stylesheet" href="/linebacker/css/codemirror.css" /></head><body><header id="site-header"><div class="navbar-wrapper"><div class="container"><div class="row"><div class="col-xs-6"><a href="/linebacker/" class="brand"><div class="icon-wrapper"><span>linebacker</span></div></a></div><div class="col-xs-6"><nav class="text-right"><ul class=""><li><a href="https://github.com/ChristopherDavenport/linebacker"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="https://christopherdavenport.github.io/linebacker"><i class="fa fa-file-text"></i><span class="hidden-xs">Documentation</span></a></li></ul></nav></div></div></div></div><div class="jumbotron"><div class="container"><h1 class="text-center">Thread Pool Management for Scala</h1><h2></h2><p class="text-center"><a href="https://github.com/ChristopherDavenport/linebacker" class="btn btn-outline-inverse">View on GitHub</a></p></div></div><div><ul class="horizontalNav">     <li><a class=" active " href="/linebacker/"></a></li>  <li><a class="" href="/linebacker/changelog.html">changelog</a></li>  <li><a class="" href="/linebacker/code-of-conduct.html">code of conduct</a></li>  <li><a class="" href="/linebacker/license.html">license</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><h1 id="linebacker---">Linebacker <a href="https://travis-ci.org/ChristopherDavenport/linebacker"><img src="https://travis-ci.org/ChristopherDavenport/linebacker.svg?branch=master" alt="Build Status" /></a> <a href="https://maven-badges.herokuapp.com/maven-central/io.chrisdavenport/linebacker_2.12"><img src="https://maven-badges.herokuapp.com/maven-central/io.chrisdavenport/linebacker_2.12/badge.svg" alt="Maven Central" /></a> <a href="https://gitter.im/christopherdavenport/linebacker"><img src="https://badges.gitter.im/christopherdavenport/linebacker.png" alt="Gitter chat" /></a></h1>

<p>Enabling Functional Blocking where you need it.</p>

<h2 id="quick-start">Quick Start</h2>

<p>To use linebacker in an existing SBT project with Scala 2.11 or a later version, add the following dependency to your
<code class="highlighter-rouge">build.sbt</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"io.chrisdavenport"</span> <span class="o">%%</span> <span class="s">"linebacker"</span> <span class="o">%</span> <span class="s">"&lt;version&gt;"</span>
</code></pre>
</div>

<h2 id="why-linebacker">Why Linebacker</h2>

<p>Concurrency is hard.</p>

<h2 id="no-seriously-why-linebacker">No Seriously, Why Linebacker</h2>

<p>Generally threading models have to deal with the idea that in java/scala some of our fundamental calls
are still blocking. Looking at you JDBC! In order to handle this we generally utilize Executors or
ExecutionContexts. Additionally many libraries now utilize implicit execution contexts for their shifting.
This puts us in a position where we need to manually and explicitly pass around two contexts raising one
explicitly where appropriate and then shifting work back and forth from the pools as appropriate.</p>

<p>Here is where we attempt to make these patterns easier. This library provides abstractions for managing
pools and shifting behavior between your pools.</p>

<p>Why should you care? Let us propose you have a single pool on 5 threads and you receive 5 requests that
require communicating with a database. What happens if a 6th call comes in when all these CPU bound threads
are blocked on network IO? Obviously we are waiting for threads.</p>

<p>Some additional resources for why this is important:</p>

<blockquote class="twitter-tweet" data-lang="en" align="center"><p lang="en" dir="ltr">Thread pool best practices. <br />For more info, see <a href="https://twitter.com/djspiewak?ref_src=twsrc%5Etfw">@djspiewak</a> &amp; <a href="https://twitter.com/alexelcu?ref_src=twsrc%5Etfw">@alexelcu</a> posts:<a href="https://t.co/pr6McpU3tH">https://t.co/pr6McpU3tH</a><a href="https://t.co/Vz617IMjRB">https://t.co/Vz617IMjRB</a> <a href="https://t.co/gJgzZI6yGJ">pic.twitter.com/gJgzZI6yGJ</a></p>&mdash; Impure Pics (@impurepics) <a href="https://twitter.com/impurepics/status/987758585722621957?ref_src=twsrc%5Etfw">April 21, 2018</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<ul>
  <li><a href="https://gist.github.com/djspiewak/46b543800958cf61af6efa8e072bfd5c">Thread Pools</a> by Daniel Spiewak</li>
  <li><a href="https://monix.io/docs/3x/best-practices/blocking.html">Best Practice: Should Not Block Threads</a> by Alexandru Nedelcu/Monix</li>
</ul>

<h2 id="examples">Examples</h2>

<p>First some imports</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.global</span>
<span class="k">import</span> <span class="nn">cats.effect._</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">io.chrisdavenport.linebacker.Linebacker</span>
<span class="k">import</span> <span class="nn">io.chrisdavenport.linebacker.contexts.Executors</span>
</code></pre>
</div>

<p>Creating And Evaluating Pool Behavior</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">getThread</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="n">currentThread</span><span class="o">().</span><span class="n">getName</span><span class="o">)</span>
<span class="n">getThread</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$2046378171</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">checkRun</span> <span class="k">=</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="nc">Executors</span><span class="o">.</span><span class="n">unbound</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="c1">// Create Executor
</span>     <span class="o">|</span>     <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="nc">Linebacker</span><span class="o">.</span><span class="n">fromExecutorService</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="k">_</span><span class="o">))</span> <span class="c1">// Create Linebacker From Executor
</span>     <span class="o">|</span>     <span class="o">.</span><span class="n">use</span><span class="o">{</span> <span class="k">implicit</span> <span class="n">linebacker</span> <span class="k">=&gt;</span> <span class="c1">// Raise Implicitly
</span>     <span class="o">|</span>       <span class="k">implicit</span> <span class="k">val</span> <span class="n">cs</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">.</span><span class="n">contextShift</span><span class="o">(</span><span class="n">global</span><span class="o">)</span>
     <span class="o">|</span>       <span class="nc">Linebacker</span><span class="o">[</span><span class="kt">IO</span><span class="o">].</span><span class="n">blockCS</span><span class="o">(</span><span class="n">getThread</span><span class="o">)</span> <span class="c1">// Block On Linebacker Pool Not Global
</span>     <span class="o">|</span>         <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">threadName</span> <span class="k">=&gt;</span> <span class="nc">IO</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">threadName</span><span class="o">)))</span> <span class="o">&gt;&gt;</span>
     <span class="o">|</span>       <span class="n">getThread</span> <span class="c1">// Running On Global
</span>     <span class="o">|</span>         <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">threadName</span> <span class="k">=&gt;</span> <span class="nc">IO</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">threadName</span><span class="o">)))</span>
     <span class="o">|</span>     <span class="o">}</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">checkRun</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$652601282</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">checkRun</span><span class="o">.</span><span class="n">unsafeRunSync</span>
<span class="n">linebacker</span><span class="o">-</span><span class="n">thread</span><span class="o">-</span><span class="mi">0</span>
<span class="n">scala</span><span class="o">-</span><span class="n">execution</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="n">global</span><span class="o">-</span><span class="mi">48</span>
</code></pre>
</div>

<p>Dual Contexts Are Also Very Useful</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">io.chrisdavenport.linebacker.DualContext</span>
<span class="k">import</span> <span class="nn">io.chrisdavenport.linebacker.DualContext</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Executors</span><span class="o">.</span><span class="n">unbound</span><span class="o">[</span><span class="kt">IO</span><span class="o">].</span><span class="n">map</span><span class="o">(</span><span class="n">blockingExecutor</span> <span class="k">=&gt;</span>
     <span class="o">|</span>   <span class="nc">DualContext</span><span class="o">.</span><span class="n">fromContexts</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="nc">IO</span><span class="o">.</span><span class="n">contextShift</span><span class="o">(</span><span class="n">global</span><span class="o">),</span>  <span class="nc">ExecutionContext</span><span class="o">.</span><span class="n">fromExecutorService</span><span class="o">(</span><span class="n">blockingExecutor</span><span class="o">))</span>
     <span class="o">|</span> <span class="o">)</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">cats.effect.Resource</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">io.chrisdavenport.linebacker.DualContext</span><span class="o">[</span><span class="kt">cats.effect.IO</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Bind</span><span class="o">(</span><span class="nc">Bind</span><span class="o">(</span><span class="nc">Allocate</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;),</span><span class="n">io</span><span class="o">.</span><span class="n">chrisdavenport</span><span class="o">.</span><span class="n">linebacker</span><span class="o">.</span><span class="n">contexts</span><span class="o">.</span><span class="nc">Executors$$$Lambda$4788</span><span class="o">/</span><span class="mi">847246193</span><span class="k">@</span><span class="mf">4f</span><span class="n">bd3ec3</span><span class="o">),</span><span class="n">cats</span><span class="o">.</span><span class="n">effect</span><span class="o">.</span><span class="nc">Resource$$Lambda$4790</span><span class="o">/</span><span class="mi">1155320187</span><span class="k">@</span><span class="mi">59309</span><span class="n">c87</span><span class="o">)</span>
</code></pre>
</div>
</div></div></section><section class="technologies"><div class="container"><div class="row"></div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>linebacker is designed and developed by <a href="" target="_blank">Christopher Davenport</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/ChristopherDavenport/linebacker"><span class="fa fa-github"></span>View on GitHub</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/linebacker/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'ChristopherDavenport/linebacker'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script></body></html>